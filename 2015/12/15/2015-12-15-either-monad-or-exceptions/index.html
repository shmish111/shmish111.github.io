<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Either monad or exceptions | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="TL;DR The Either monad from cats is pretty cool.
Recently I was asked to complete a small test for a job interview in the form of a Clojure program. The idea of the program was to take commands from s">
<meta property="og:type" content="article">
<meta property="og:title" content="Either monad or exceptions">
<meta property="og:url" content="http://yoursite.com/2015/12/15/2015-12-15-either-monad-or-exceptions/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="TL;DR The Either monad from cats is pretty cool.
Recently I was asked to complete a small test for a job interview in the form of a Clojure program. The idea of the program was to take commands from s">
<meta property="og:updated_time" content="2016-03-08T22:24:18.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Either monad or exceptions">
<meta name="twitter:description" content="TL;DR The Either monad from cats is pretty cool.
Recently I was asked to complete a small test for a job interview in the form of a Clojure program. The idea of the program was to take commands from s">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2015-12-15-either-monad-or-exceptions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/15/2015-12-15-either-monad-or-exceptions/" class="article-date">
  <time datetime="2015-12-15T00:00:00.000Z" itemprop="datePublished">2015-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Either monad or exceptions
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>TL;DR</strong> The <code>Either</code> monad from <a href="https://github.com/funcool/cats" target="_blank" rel="external">cats</a> is pretty cool.</p>
<p>Recently I was asked to complete a small test for a job interview in the form of a Clojure program. The idea of the program was to take commands from stdin and use them to mess around with a ‘canvas’, basically a super-primitive graphics program. It occured to me that since part of this would involve parsing and validating commands and displaying any errors, it might be a good opportunity to use the Either monad and see the current state of monad libraries in Clojure.</p>
<p>I have used <a href="https://github.com/clojure/algo.monads" target="_blank" rel="external">algo.monads</a> in the past but looking at the project on github I could see that it hadn’t been updated in more than 11 months. I thought that perhaps there has been some work done in this area since then and I discovered <a href="https://github.com/funcool/cats" target="_blank" rel="external">cats</a>. It has some nice documentation and a nice philosophy so I decided to give it a try.</p>
<p>The program flow is:</p>
<ul>
<li>read-line from the console</li>
<li>split the input by the space character</li>
<li>dispatch the arguments and the current state of the program to a multi-method, based on the first argument</li>
<li>return the new state or a string to display on the console</li>
<li>loop round to read-line again</li>
</ul>
<p>This flow allows me to use pure functions for the multi-method as in the following command which flood-fills an area of the canvas:</p>
<figure class="highlight clj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">defn</span></span> valid-number-of-args</span><br><span class="line">  [args n]</span><br><span class="line">  (<span class="name"><span class="builtin-name">if</span></span> (<span class="name"><span class="builtin-name">=</span></span> n (<span class="name"><span class="builtin-name">count</span></span> args))</span><br><span class="line">    (<span class="name">right</span> args)</span><br><span class="line">    (<span class="name">left</span> (<span class="name"><span class="builtin-name">str</span></span> <span class="string">"invalid number of arguments, expected "</span> n))))</span><br><span class="line"></span><br><span class="line">(<span class="name"><span class="builtin-name">defmethod</span></span> do-command <span class="string">"F"</span></span><br><span class="line">  [_ state &amp; args]</span><br><span class="line">  (<span class="name">m/mlet</span> [[x y colour] (<span class="name">valid-number-of-args</span> args <span class="number">3</span>)</span><br><span class="line">           pixel (<span class="name">valid-pixel</span> state x y)</span><br><span class="line">           _ (<span class="name">valid-colour</span> colour)]</span><br><span class="line">          (<span class="name">m/return</span> (<span class="name">flood-fill</span> pixel colour state))))</span><br></pre></td></tr></table></figure>
<p><code>mlet</code> is analogous to do notation in Haskell. <code>valid-number-of-args</code>, <code>valid-pixel</code> and <code>valid-colour</code> are functions that return either a <code>Right</code> containing the value or a <code>Left</code> containing an error.</p>
<p>It’s probably clear that I could have used functions that throw an Exception with the error message, the above would then look like:</p>
<figure class="highlight clj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">defn</span></span> valid-number-of-args</span><br><span class="line">  [args n]</span><br><span class="line">  (<span class="name"><span class="builtin-name">if</span></span> (<span class="name"><span class="builtin-name">=</span></span> n (<span class="name"><span class="builtin-name">count</span></span> args))</span><br><span class="line">    args</span><br><span class="line">    (<span class="name"><span class="builtin-name">throw</span></span> (<span class="name">Exception.</span> (<span class="name"><span class="builtin-name">str</span></span> <span class="string">"invalid number of arguments, expected "</span> n)))))</span><br><span class="line"></span><br><span class="line">(<span class="name"><span class="builtin-name">defmethod</span></span> do-command <span class="string">"F"</span></span><br><span class="line">  [_ state &amp; args]</span><br><span class="line">  (<span class="name"><span class="builtin-name">let</span></span> [[x y colour] (<span class="name">valid-number-of-args</span> args <span class="number">3</span>)</span><br><span class="line">        pixel (<span class="name">valid-pixel</span> state x y)</span><br><span class="line">        _ (<span class="name">valid-colour</span> colour)]</span><br><span class="line">        (<span class="name">flood-fill</span> pixel colour state)))</span><br></pre></td></tr></table></figure>
<p>You could argue that the second version, apart from being slightly more terse, is more idiomatic however I don’t believe this is true, Exceptions in Java were never intended to be used for unexceptional flow, it’s just that they have become commonly used in this way, precisely because they are basically a strange form of the Either monad, why not just use the real thing when dealing with non-exceptional flow? It also looks better if you can avoid instantiating java classes such as <code>Exception</code> in my opinion.</p>
<p>In this particular case the flow is not ‘exceptional’ at all since some of the commands such as ‘S’ which displays the current state on the console, should return a string even though there is no ‘error’. Having a function that always throws an <code>Exception</code> and yet is successful seems a bit dodgy to me. With <code>Either</code> you are not saying that <code>Left</code> are errors but rather that they are strings that should be displayed to the user.</p>
<p>I have also been using promises in the form of <a href="https://github.com/ztellman/manifold" target="_blank" rel="external">manifold</a> a lot recently and the semantics of this are almost exactly the same as <code>Either</code> and <code>mlet</code> above, a manifold <code>deferred</code> is essentially an async <code>Either</code>. Add to this that manifold can be used with cats and it adds up to a more consistent way of doing things. Everything looks the same, it’s just a matter of whether you want something to be async or not.</p>
<p>Finally, because an <code>Exception</code> will keep going up the call-chain until it is caught, it’s possible to introduce bugs where the <code>Execption</code> disappears into the ether, this can be a pain to discover sometimes. Using the <code>Either</code> semantics, Clojure’s type system will usually throw a runtime exception and problems will be slightly easier to spot.</p>
<p>My conclusion is that I like using <code>Either</code> in Clojure and I like cats :) I think I will use both in the future. It’s also nice to note that cats and some related libraries are moving Clojure in directions other than what the clojure.core team is doing. As clojure.core gets better and more innovative, the libraries and tools do as well. It makes me glad to be using Clojure and hopeful for it’s future.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/15/2015-12-15-either-monad-or-exceptions/" data-id="ciljzfxp10003ngrr9szt126l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/03/08/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
    <a href="/2014/09/09/2014-09-09-static-vs-dynamic/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Static vs Dynamic</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/05/03/2016-05-03-generative-testing/">Generative Testing</a>
          </li>
        
          <li>
            <a href="/2016/03/08/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2015/12/15/2015-12-15-either-monad-or-exceptions/">Either monad or exceptions</a>
          </li>
        
          <li>
            <a href="/2014/09/09/2014-09-09-static-vs-dynamic/">Static vs Dynamic</a>
          </li>
        
          <li>
            <a href="/2014/08/10/2014-08-10-configuring-rest-api-endpoint-in-angular/">Configuring REST API endpoint in angular</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>